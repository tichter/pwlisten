(function b(c,d,e){function a(h,i){if(!d[h]){if(!c[h]){var j="function"==typeof require&&require;if(!i&&j)return j(h,!0);if(g)return g(h,!0);var k=new Error("Cannot find module '"+h+"'");throw k.code="MODULE_NOT_FOUND",k}var f=d[h]={exports:{}};c[h][0].call(f.exports,function(b){var d=c[h][1][b];return a(d?d:b)},f,f.exports,b,c,d,e)}return d[h].exports}for(var g="function"==typeof require&&require,f=0;f<e.length;f++)a(e[f]);return a})({1:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d=window.AudioContext||window.webkitAudioContext,e=c.audioContext=new d},{}],2:[function(a,b,c){"use strict";function d(a,b,c){this.urlList=a,this.buffers=(0,f.arrayFilledWith)(null,a.length),this.gainNodes=[g.audioContext.createGain(),g.audioContext.createGain()],this.gainNodeIndex=0;for(var d=0;2>d;++d)this.gainNodes[d].connect(g.audioContext.destination),this.gainNodes[d].gain.value=0;this.startedPlayingAtTime=null,this.fadeTime=0.1,this.currentIndex=null,this.onsetTime=0,this.continuousPlayback=b,this.loopPlayback=c,this.hasPlayed=[],this.allOk=!1,this.numberOfClicks=0}Object.defineProperty(c,"__esModule",{value:!0}),c.AudioLoader=d;var e=a("./dollar.js"),f=a("./utils.js"),g=a("./audioengine.js");d.prototype.loadBuffer=function(a,b,c){var d=new XMLHttpRequest;d.responseType="arraybuffer",d.open("GET",a,!0);var e=this;d.onload=function(){g.audioContext.decodeAudioData(d.response,function(d){return d?void(e.buffers[b]=d,e.checkBuffers(c)):void window.alert("error decoding file data: "+a)},function(a){console.error("decodeAudioData error",a)})},d.send(),this.hasPlayed.push(!1)},d.prototype.checkBuffers=function(a){this.allOk=!0;for(var b=0;b<this.buffers.length;++b)null==this.buffers[b]&&(this.allOk=!1);this.allOk&&(e.$.mobile.loading("hide"),"function"==typeof a&&a())},d.prototype.load=function(a){e.$.mobile.loading("show"),this.allOk=!1;for(var b=0;b<this.urlList.length;++b)this.loadBuffer(this.urlList[b],b,a);this.timerStarted=!1},d.prototype.play=function(a){if(a!==this.currentIndex&&this.allOk){this.switchStop(),this.source=g.audioContext.createBufferSource();var b=this.buffers[a];this.source.buffer=b,this.source.loop=this.loopPlayback,this.source.loopStart=!1,this.loopPlayback||(this.source.onended=function(){this.currentIndex===a&&(this.currentIndex=null)}.bind(this));var c=this.gainNodes[this.gainNodeIndex];if(this.source.connect(c),this.continuousPlayback)if(null==this.currentIndex)this.onsetTime=0;else{var d=this.buffers[this.currentIndex].duration;this.onsetTime+=g.audioContext.currentTime-this.startedPlayingAtTime,this.onsetTime>d&&(this.onsetTime%=d),this.onsetTime>b.duration&&(this.onsetTime=0)}this.hasPlayed[a]=!0,this.currentIndex=a,this.startedPlayingAtTime=g.audioContext.currentTime,this.startTimer(),this.numberOfClicks+=1,this.source.start(0,this.onsetTime),c.gain.linearRampToValueAtTime(1,g.audioContext.currentTime+this.fadeTime)}},d.prototype.startTimer=function(){this.timerStarted||(this.startTime=g.audioContext.currentTime,this.timerStarted=!0)},d.prototype.endTimer=function(){return this.timerStarted=!1,g.audioContext.currentTime-this.startTime},d.prototype.switchStop=function(){this.stop(!1)},d.prototype.stop=function(a){if(this.source){var b=g.audioContext.currentTime+this.fadeTime,c=this.gainNodes[this.gainNodeIndex];c.gain.linearRampToValueAtTime(0,b),this.source.stop(b),this.gainNodeIndex=(this.gainNodeIndex+1)%2,this.source=null,a&&(this.currentIndex=null)}},d.prototype.haveAllBuffersPlayed=function(){return this.hasPlayed.every(function(a){return a})}},{"./audioengine.js":1,"./dollar.js":3,"./utils.js":7}],3:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.activePage=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"";return d(".ui-page-active "+a)};var d=c.$=window.jQuery},{}],4:[function(a){"use strict";function b(a,b){return(0,c.activePage)(".next").off(),(0,c.activePage)(".back").off(),(0,c.$)(".ui-content").find("*").off(),(0,c.$)(".submit-form").on("submit",function(){c.$.mobile.loading("show")}),(0,c.$)(".submit-form .cancel").on("click",function(){(0,c.$)(".submit-popup").popup("close")}),a=JSON.parse(a),a.siteURL=b,a}var c=a("./dollar.js"),d=a("./pickthebest.js");window.listen={createPickTheBest:function(a,c){return new d.PickTheBest(b(a,c))}}},{"./dollar.js":3,"./pickthebest.js":6}],5:[function(a,b,c){"use strict";function d(a){(0,e.activePage)(".ui-content").find("*").off(),this.config=a,this.codeidx=-1;for(var b=0;b<a.codes.length;b++)a.codes[b].code===a.incode&&(this.codeidx=b);if(this.pageCounter=0,this.numberOfSounds=0,this.numberOfPages=this.config.codes[this.codeidx].pages.length,this.currentPageSoundOrder=null,this.config.add_consistency_check){var c=h.randomNumber(0,this.numberOfPages,!0);this.numberOfPages+=1;var d=JSON.parse(JSON.stringify(this.config.codes[this.codeidx].pages[c]));this.config.codes[this.codeidx].pages[c].is_replicate=!0,d.is_replicate=!0,this.config.codes[this.codeidx].pages.push(d)}this.have_seen_this_page_before=h.arrayFilledWith(!1,this.numberOfPages+1),this.pageOrder=h.fromAToBArray(0,this.numberOfPages),this.config.randomise_pages&&h.shuffle(this.pageOrder),this.soundOrder=[];for(var f=0;f<this.numberOfPages;++f){var g=this.config.codes[this.codeidx].pages[this.pageOrder[f]].sounds.length,i=h.fromAToBArray(0,g);this.config.randomise_sounds_within_page&&h.shuffle(i),this.soundOrder.push(i)}this.configureButtons(),this.updateTitle(),this.loadPage()}Object.defineProperty(c,"__esModule",{value:!0}),c.PageManager=d;var e=a("./dollar.js"),f=a("./audioloader.js"),g=a("./utils.js"),h=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(g);d.prototype.interfaceDependentConditionsMet=function(){return!0},d.prototype.configureButtons=function(){this.next_url=(0,e.activePage)(".next").attr("href"),(0,e.activePage)(".next").removeAttr("href"),(0,e.activePage)(".next").on("click",function(){this.loader.haveAllBuffersPlayed()||!this.config.must_play_all_samples_to_continue||this.have_seen_this_page_before[this.pageCounter+1]?this.interfaceDependentConditionsMet()&&this.onNextOrBackButtonClick(1):((0,e.activePage)(".listen-to-all-samples-popup").popup("open"),setTimeout(function(){(0,e.activePage)(".listen-to-all-samples-popup").popup("close")},5e3))}.bind(this)),(0,e.activePage)(".back").on("click",function(){this.onNextOrBackButtonClick(-1)}.bind(this)),(0,e.activePage)(".early-finish").on("click",function(){this.loader&&this.loader.stop(!0),this.fillConfig(),this.complete()}.bind(this))},d.prototype.onNextOrBackButtonClick=function(a){this.loader&&this.loader.stop(!0),0===this.pageCounter&&0>a?this.config.back_button_can_exit_test&&window.history.back():((0,e.activePage)(".back").show(),!this.have_seen_this_page_before[this.pageCounter]&&(this.have_seen_this_page_before[this.pageCounter]=!0),this.fillConfig(),this.pageCounter=h.selectMinimum(this.pageCounter+a,this.numberOfPages),this.pageCounter=h.selectMaximum(this.pageCounter,0),this.pageCounter===this.numberOfPages?(this.complete(),this.pageCounter-=1):(this.updateTitle(),this.loadPage()))},d.prototype.updateTitle=function(){(0,e.activePage)(".title").html(this.pageCounter+1+" / "+this.numberOfPages)},d.prototype.loadPage=function(){this.currentPage=this.pageOrder[this.pageCounter],this.currentPageSoundOrder=this.soundOrder[this.pageCounter],this.numberOfSounds=this.currentPageSoundOrder.length,this.urls=Array(this.numberOfSounds);for(var a,b=0;b<this.numberOfSounds;++b)a=this.config.codes[this.codeidx].pages[this.currentPage].sounds[b],this.urls[b]=this.config.siteURL+"/"+a.url;for(var c=this.config.codes[this.codeidx].pages[this.currentPage].references,d=0;d<c.length;++d)this.urls.push(this.config.siteURL+"/"+c[d].url);this.loader=new f.AudioLoader(this.urls,this.config.continuous_playback,this.config.loop_playback),this.loader.load(this.setupGUI.bind(this))},d.prototype.setupGUI=function(){},d.prototype.fillConfig=function(){var a=this.config.codes[this.codeidx].pages[this.currentPage].duration;(null==a||0===a)&&(this.loader.timerStarted?this.config.codes[this.codeidx].pages[this.currentPage].duration=this.loader.endTimer():this.config.codes[this.codeidx].pages[this.currentPage].duration=0),this.config.codes[this.codeidx].pages[this.currentPage].numberofclicks=this.loader.numberOfClicks,this.config.codes[this.codeidx].pages[this.currentPage].order=this.pageCounter,null==this.config.codes[this.codeidx].pages[this.currentPage].is_replicate&&(this.config.codes[this.codeidx].pages[this.currentPage].is_replicate=!1),this.completeConfig()},d.prototype.completeConfig=function(){},d.prototype.complete=function(){var a=JSON.stringify(this.config.codes[this.codeidx]);(0,e.activePage)("input[name=\"intercode\"]").val(this.config.codes[this.codeidx].intercode),this.config.allow_submission?((0,e.activePage)("input[name=\"fields[data]\"]").val(a),(0,e.activePage)(".submit-popup").popup("open")):e.$.mobile.changePage(this.next_url)},d.prototype.playBuf=function(a){this.loader.play(this.currentPageSoundOrder[a])}},{"./audioloader.js":2,"./dollar.js":3,"./utils.js":7}],6:[function(a,b,c){"use strict";function d(a){g.PageManager.call(this,a),(0,e.activePage)(".stop-audio").on("click",function(){this.loader.stop(!0)}.bind(this))}Object.defineProperty(c,"__esModule",{value:!0}),c.PickTheBest=d;var e=a("./dollar.js"),f=a("./audioloader.js"),g=a("./pagemanager.js"),h=a("./utils.js"),i=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}(h);d.prototype=Object.create(g.PageManager.prototype),d.prototype.constructor=d,d.prototype.setupGUI=function(){(0,e.activePage)(".interface-container").show(),this.createReferences(),this.createButtons()},d.prototype.createReferences=function(){(0,e.activePage)(".references-container").empty();for(var a=this.config.codes[this.codeidx].pages[this.currentPage].references,b=0;b<a.length;++b)(0,e.activePage)(".references-container").append("<a class='reference' data-role='button' data-inline='true'>"+a[b].button_label+"</a>");var c=this;(0,e.activePage)(".reference").each(function(a){(0,e.$)(this).on("click",function(){c.loader.play(c.numberOfSounds+a)})}),(0,e.activePage)(".references-container").trigger("create"),(0,e.activePage)(".references-container").enhanceWithin()},d.prototype.createButtons=function(){(0,e.activePage)(".button-container").empty();for(var a,b=0;b<this.numberOfSounds;++b){if(a="",this.have_seen_this_page_before[this.pageCounter]){var c=this.currentPageSoundOrder[b];this.config.codes[this.codeidx].pages[this.currentPage].sounds[c].value&&(a="checked")}var d=b+1,f="<label data-iconpos='left'><input type='checkbox'"+a+"></label>";(0,e.activePage)(".button-container").append("<div class='checkbox-button-wrapper'>"+("<button class='test-button' data-inline='true'>"+d+"</button>")+f+"</div>")}(0,e.activePage)(".button-container").trigger("create"),(0,e.activePage)(".button-container").enhanceWithin();var g=this;(0,e.activePage)(".test-button").each(function(a){(0,e.$)(this).on("click",function(a){g.playBuf(a)}.bind(null,a))})},d.prototype.completeConfig=function(){var a=function(a,b){var c=this.currentPageSoundOrder[a];this.config.codes[this.codeidx].pages[this.currentPage].sounds[c].value=b}.bind(this);(0,e.activePage)("[type=checkbox]").each(function(b){var c=(0,e.$)(this).is(":checked");a(b,c)})},d.prototype.interfaceDependentConditionsMet=function(){if(this.config.allow_ties)return!0;var a=[];(0,e.activePage)("[type=checkbox]").each(function(){a.push((0,e.$)(this).is(":checked"))});var b=a.reduce(function(a,b){return a+b});return 1<b?((0,e.activePage)(".ties-warning-popup").popup("open"),setTimeout(function(){(0,e.activePage)(".ties-warning-popup").popup("close")},5e3),!1):0!==b||((0,e.activePage)(".no-selection-warning-popup").popup("open"),setTimeout(function(){(0,e.activePage)(".no-selection-warning-popup").popup("close")},5e3),!1)}},{"./audioloader.js":2,"./dollar.js":3,"./pagemanager.js":5,"./utils.js":7}],7:[function(a,b,c){"use strict";function d(c,a){a<=c&&(a=c+1);for(var b=a-c,d=Array(b),e=0;e<b;++e)d[e]=c+e;return d}// https://stackoverflow.com/questions/10716986/swap-2-html-elements-and-preserve-event-listeners-on-them
var e=Math.floor;Object.defineProperty(c,"__esModule",{value:!0}),c.fromAToBArray=d,c.arrayFilledWith=function(a,b){for(var c=Array(b),d=0;d<b;++d)c[d]=a;return c},c.randomNumber=function(a,b,c){var d=Math.random();return d*=b-a,d+=a,c&&(d=e(d)),d},c.shuffle=function(b){var a,c,d;for(d=b.length;d;d--)a=e(Math.random()*d),c=b[d-1],b[d-1]=b[a],b[a]=c},c.selectMaximum=function(c,a){return c>a?c:a},c.selectMinimum=function(c,a){return c<a?c:a},c.newSortedArray=function(a){var b=a.slice();return b.sort(function(c,a){return c-a})},c.indicesNeededToSortArray=function(c){var a=d(0,c.length);return a.sort(function(d,a){return c[d]<c[a]?-1:c[d]>c[a]?1:0})},c.swapElements=function(a,b){var c=document.createElement("div");a.parentNode.insertBefore(c,a),b.parentNode.insertBefore(a,b),c.parentNode.insertBefore(b,c),c.parentNode.removeChild(c)}},{}]},{},[4]);